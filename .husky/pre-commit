#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running pre-commit checks..."

# Check for debug statements in staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=d)

# Check for common debug patterns
DEBUG_FOUND=0
for file in $STAGED_FILES; do
    if echo "$file" | grep -qE "\.(js|vue|ts|php)$"; then
        if git show ":$file" 2>/dev/null | grep -qE "console\.log|debugger|dd\(|dump\(|var_dump"; then
            echo "‚ö†Ô∏è  Possible debug code in: $file"
            DEBUG_FOUND=1
        fi
    fi
done

if [ $DEBUG_FOUND -eq 1 ]; then
    echo "‚ùå Remove debug statements before committing (or use --no-verify to bypass)"
    exit 1
fi

# Run lint-staged for automated code formatting
npx lint-staged

echo "‚úÖ Pre-commit checks passed!"
